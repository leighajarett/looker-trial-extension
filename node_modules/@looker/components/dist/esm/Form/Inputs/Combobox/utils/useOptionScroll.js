import { useContext, useEffect } from 'react';
import { useCallbackRef } from '../../../../utils';
import { ComboboxActionType } from './state';
const relativeElementVisibility = (listElement, containerScrollPosition, containerHeight = 0) => {
    const { offsetTop } = listElement;
    const isAbove = offsetTop < containerScrollPosition;
    const isBelow = offsetTop >= containerScrollPosition + containerHeight;
    return (isAbove && 'above') || (isBelow && 'below') || 'visible';
};
export function useOptionScroll(context, value, label, scrollIntoView, isActive) {
    const { transition, listScrollPosition = 0, listClientRect = { height: 0 }, isAutoScrollingRef, } = useContext(context);
    const [newTriggerElement, callbackRef] = useCallbackRef();
    useEffect(() => {
        if (scrollIntoView) {
            if (newTriggerElement) {
                newTriggerElement.scrollIntoView();
            }
            if (!isActive) {
                transition &&
                    transition(ComboboxActionType.NAVIGATE, {
                        option: { label, value },
                    });
            }
        }
    }, [newTriggerElement, scrollIntoView]);
    useEffect(() => {
        if (isActive && newTriggerElement) {
            const visibility = relativeElementVisibility(newTriggerElement, listScrollPosition, listClientRect.height);
            if (visibility !== 'visible') {
                if (isAutoScrollingRef)
                    isAutoScrollingRef.current = true;
                window.requestAnimationFrame(() => {
                    if (isAutoScrollingRef)
                        isAutoScrollingRef.current = false;
                });
                const attachToTop = visibility === 'above';
                newTriggerElement.scrollIntoView(attachToTop);
            }
        }
    }, [newTriggerElement, isActive]);
    return callbackRef;
}
//# sourceMappingURL=useOptionScroll.js.map