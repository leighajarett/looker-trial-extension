import React, { useContext, useMemo } from 'react';
import styled from 'styled-components';
import { Box } from '../../../Layout';
import { ListItem } from '../../../List';
import { Heading, Paragraph } from '../../../Text';
import { ComboboxMultiContext, ComboboxMultiOption, ComboboxOption, comboboxOptionGrid, ComboboxOptionText, } from '../Combobox';
import { notInOptions } from './utils/options';
import { useWindowedOptions } from './utils/useWindowedOptions';
const renderOption = (option, index, scrollIntoView) => {
    if (option.description) {
        return (React.createElement(ComboboxOption, Object.assign({}, option, { key: index, py: "xxsmall", scrollIntoView: scrollIntoView }),
            React.createElement(SelectOptionWithDescription, Object.assign({}, option))));
    }
    return React.createElement(ComboboxOption, Object.assign({}, option, { key: index }));
};
const renderMultiOption = (option, index, scrollIntoView) => {
    if (option.description) {
        return (React.createElement(ComboboxMultiOption, Object.assign({}, option, { key: index, py: "xxsmall", scrollIntoView: scrollIntoView }),
            React.createElement(SelectOptionWithDescription, Object.assign({}, option))));
    }
    return React.createElement(ComboboxMultiOption, Object.assign({}, option, { key: index }));
};
export function SelectOptionWithDescription({ description, }) {
    return (React.createElement(Box, null,
        React.createElement(Heading, { fontSize: "small", fontWeight: "semiBold", pb: "xxsmall" },
            React.createElement(ComboboxOptionText, null)),
        React.createElement(Paragraph, { variant: "subdued", fontSize: "small" }, description)));
}
const SelectOptionGroupTitle = styled(Heading).withConfig({ displayName: "SelectOptionGroupTitle", componentId: "sc-dp1svm" }) `
  padding-top: ${({ theme }) => theme.space.xxsmall};
  ${comboboxOptionGrid}
  ${({ isMulti, theme }) => isMulti ? `grid-template-columns: ${theme.space.xlarge} 1fr;` : ''}
`;
SelectOptionGroupTitle.defaultProps = {
    fontSize: 'xxsmall',
    fontWeight: 'semiBold',
    px: 'xsmall',
    py: 'xxsmall',
    variant: 'subdued',
};
export const SelectOptionGroup = ({ options, label, isMulti, }) => (React.createElement(SelectOptionGroupContainer, null,
    label && (React.createElement(SelectOptionGroupTitle, { isMulti: isMulti },
        React.createElement("span", null),
        label)),
    options.map((option, index) => isMulti ? renderMultiOption(option, index) : renderOption(option, index))));
const SelectOptionGroupContainer = styled.div.withConfig({ displayName: "SelectOptionGroupContainer", componentId: "sc-t9dag5" }) `
  padding: ${({ theme }) => theme.space.xsmall} 0;
  border-top: 1px solid;
  border-bottom: 1px solid;
  border-color: ${({ theme }) => theme.colors.palette.charcoal200};
  &:first-child,
  & + div {
    border-top: none;
  }
  &:last-child {
    border-bottom: none;
  }
`;
export function SelectOptions({ options, isFilterable, showCreate, formatCreateLabel, isMulti, noOptionsLabel = 'No options', windowedOptions, }) {
    const { start, end, before, after, scrollToFirst, scrollToLast, } = useWindowedOptions(windowedOptions, options, isMulti);
    const optionsToRender = options && options.slice(start, end + 1);
    const renderToUse = isMulti ? renderMultiOption : renderOption;
    const noOptions = (React.createElement(ListItem, { fontSize: "small", px: "medium", py: "xxsmall" }, noOptionsLabel));
    const createOption = isFilterable && showCreate && (React.createElement(SelectMultiCreateOption, { options: options, formatLabel: formatCreateLabel, noOptions: noOptions, key: "create" }));
    return (React.createElement(React.Fragment, null,
        options && scrollToFirst
            ? renderToUse(options[0], 0, true)
            : null,
        before,
        optionsToRender && optionsToRender.length > 0
            ? [
                ...optionsToRender.map((option, index) => {
                    const optionAsGroup = option;
                    const correctedIndex = index + start;
                    return optionAsGroup.options ? (React.createElement(SelectOptionGroup, Object.assign({ key: correctedIndex }, optionAsGroup, { isMulti: isMulti }))) : (renderToUse(option, correctedIndex));
                }),
                createOption,
            ]
            : createOption || noOptions,
        after,
        options && scrollToLast
            ? renderToUse(options[options.length - 1], 0, true)
            : null));
}
function SelectMultiCreateOption({ options, noOptions, formatLabel, }) {
    const { data: { inputValue, options: currentOptions }, } = useContext(ComboboxMultiContext);
    const shouldShow = useMemo(() => {
        return notInOptions(currentOptions, options, inputValue);
    }, [currentOptions, options, inputValue]);
    if (!inputValue)
        return null;
    if (!shouldShow) {
        if (!options || options.length === 0)
            return React.createElement(React.Fragment, null, noOptions);
        return null;
    }
    return (React.createElement(ComboboxMultiOption, { value: inputValue, highlightText: false, hideCheckMark: true }, formatLabel ? formatLabel(inputValue) : `Create "${inputValue}"`));
}
//# sourceMappingURL=SelectOptions.js.map